<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Boletas - F√≠sica Simple</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.cdnfonts.com/css/proxima-nova-2');
        @import url('https://fonts.cdnfonts.com/css/8bit-operator');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            padding: 10px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border: 3px solid #000;
            border-radius: 0;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-family: 'Proxima Nova', sans-serif;
            color: #000;
            font-size: 24px;
            padding-bottom: 15px;
            border-bottom: 2px solid #000;
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 15px;
            color: #000;
        }

        .form-section input,
        .form-section select {
            width: 100%;
            padding: 12px;
            border: 2px solid #000;
            border-radius: 0;
            font-size: 16px;
            color: #000;
            background-color: #fff;
        }

        .form-section input:focus,
        .form-section select:focus {
            outline: none;
            border: 3px solid #000;
        }

        .items-section {
            margin-bottom: 20px;
        }

        .items-section h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #000;
            padding-bottom: 10px;
            border-bottom: 2px solid #000;
        }

        .item-row {
            background: #fff;
            border: 2px solid #000;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .item-row input {
            width: 100%;
            padding: 10px;
            border: 2px solid #000;
            border-radius: 0;
            font-size: 15px;
            margin-bottom: 10px;
            color: #000;
            background-color: #fff;
        }

        .item-row input:focus {
            outline: none;
            border: 3px solid #000;
        }

        .item-row label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
            color: #000;
        }

        .item-header {
            display: none;
        }

        .btn {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #000;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            transition: all 0.2s;
            background-color: #fff;
            color: #000;
        }

        .btn:active {
            background-color: #000;
            color: #fff;
        }

        .btn-add {
            background-color: #fff;
            color: #000;
            border: 2px solid #000;
        }

        .btn-remove {
            background-color: #fff;
            color: #000;
            border: 2px solid #000;
            padding: 10px;
            font-size: 14px;
            width: 100%;
            margin-top: 5px;
        }

        .btn-print {
            background-color: #000;
            color: #fff;
            font-size: 18px;
            margin-top: 20px;
            border: 3px solid #000;
        }

        .btn-print:active {
            background-color: #fff;
            color: #000;
        }

        .btn-back {
            background-color: #fff;
            color: #000;
            border: 2px solid #000;
        }

        .btn-download {
            background-color: #000;
            color: #fff;
            border: 3px solid #000;
        }

        .total-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 3px solid #000;
        }

        .total-display {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background-color: #fff;
            border: 3px solid #000;
            margin-bottom: 20px;
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 15px;
                border: 2px solid #000;
            }

            h1 {
                font-size: 20px;
                margin-bottom: 20px;
            }

            .form-section input,
            .form-section select {
                padding: 10px;
                font-size: 15px;
            }
        }

        /* Estilos para la boleta */
        .boleta {
            width: 300px;
            margin: 20px auto;
            padding: 15px;
            font-family: '8bit Operator+', monospace;
            font-size: 10pt;
            color: #000;
            background-color: #fff;
        }

        .boleta-header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px dashed #000;
            padding-bottom: 10px;
        }

        .boleta-logo {
            font-family: 'Proxima Nova', sans-serif;
            font-size: 20pt;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .boleta-lema {
            font-family: 'Proxima Nova', sans-serif;
            font-size: 9pt;
            font-style: italic;
            margin-bottom: 5px;
            color: #000;
        }

        .boleta-contacto {
            font-size: 8pt;
            line-height: 1.4;
        }

        .boleta-titulo {
            text-align: center;
            font-weight: bold;
            font-size: 11pt;
            margin: 10px 0;
            border-top: 1px dashed #000;
            border-bottom: 1px dashed #000;
            padding: 6px 0;
        }

        .boleta-info {
            font-size: 9pt;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .boleta-items {
            margin: 10px 0;
        }

        .boleta-item-header {
            display: grid;
            grid-template-columns: 40px 1fr 55px 65px;
            font-size: 8pt;
            font-weight: bold;
            border-bottom: 1px solid #000;
            padding-bottom: 4px;
            margin-bottom: 6px;
        }

        .boleta-item {
            display: grid;
            grid-template-columns: 40px 1fr 55px 65px;
            font-size: 9pt;
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .boleta-total {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #000;
            font-weight: bold;
            font-size: 12pt;
            text-align: right;
        }

        .boleta-pago {
            margin-top: 10px;
            font-size: 9pt;
        }

        .boleta-footer {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px dashed #000;
            text-align: center;
        }

        .boleta-gracias {
            font-size: 11pt;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .boleta-redes {
            font-size: 8pt;
            line-height: 1.6;
        }

        .boleta-disclaimer {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px dashed #000;
            font-size: 6pt;
            line-height: 1.5;
            text-align: justify;
        }

        /* Secci√≥n de vista previa */
        .preview-section {
            display: none;
        }

        .preview-section.visible {
            display: block;
        }

        .preview-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 3px solid #000;
            background: #fff;
        }

        .preview-container h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #000;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            font-family: 'Proxima Nova', sans-serif;
        }

        .preview-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .preview-buttons button {
            flex: 1;
        }

        #canvasContainer {
            text-align: center;
            margin: 20px 0;
            background: #f5f5f5;
            padding: 20px;
        }

        #canvasContainer canvas {
            max-width: 100%;
            height: auto;
            border: 2px solid #000;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container" id="formContainer">
        <h1>F√≠sica Simple ;)</h1>

        <div class="form-section">
            <label>Fecha:</label>
            <input type="date" id="fecha" value="">
        </div>

        <div class="form-section">
            <label>Cliente (opcional):</label>
            <input type="text" id="cliente" placeholder="Nombre del cliente">
        </div>

        <div class="form-section">
            <label>ID Interno (opcional):</label>
            <input type="text" id="idInterno" placeholder="N√∫mero de orden">
        </div>

        <div class="items-section">
            <h3>Productos</h3>
            <div class="item-header">
                <div>Cant.</div>
                <div>Producto/Servicio</div>
                <div>Precio Unit.</div>
                <div>Subtotal</div>
                <div></div>
            </div>
            <div id="itemsContainer"></div>
            <button class="btn btn-add" onclick="agregarItem()">+ AGREGAR PRODUCTO</button>
        </div>

        <div class="total-section">
            <div class="total-display">
                TOTAL: $ <span id="totalDisplay">0.00</span>
            </div>

            <div class="form-section">
                <label>Forma de pago:</label>
                <select id="formaPago">
                    <option value="Efectivo">Efectivo</option>
                    <option value="Transferencia">Transferencia</option>
                    <option value="Mercado Pago">Mercado Pago</option>
                    <option value="Otros">Otros</option>
                </select>
            </div>

            <div class="form-section" id="otrosPagoDiv" style="display: none;">
                <label>Especificar forma de pago:</label>
                <input type="text" id="otrosPago" placeholder="Ej: Tarjeta, D√©bito, etc.">
            </div>
        </div>

        <button class="btn btn-print" onclick="generarBoleta()">GENERAR IMAGEN DE BOLETA</button>
    </div>

    <!-- Secci√≥n de vista previa -->
    <div class="preview-section" id="previewSection">
        <div class="preview-container">
            <h2>Vista Previa de la Boleta</h2>
            
            <div id="canvasContainer"></div>

            <div class="preview-buttons">
                <button class="btn btn-back" onclick="volverAlFormulario()">‚Üê VOLVER AL FORMULARIO</button>
                <button class="btn btn-download" onclick="descargarImagen()">üì• DESCARGAR IMAGEN</button>
            </div>

            <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #666;">
                üí° Abre la imagen en Fun Print para imprimir tu boleta
            </p>
        </div>
    </div>

    <!-- Boleta oculta para generar imagen -->
    <div class="boleta hidden" id="boleta">
        <div class="boleta-header">
            <div class="boleta-logo">F√≠sica Simple ;)</div>
            <div class="boleta-lema">Simplificando la ense√±anza.</div>
            <div class="boleta-contacto">
                Instagram: @fisicasimpleuy<br>
                Facebook: F√≠sica Simple<br>
                www.fisicasimple.com
            </div>
        </div>

        <div class="boleta-titulo">
            DETALLE DE COMPRA<br>
            DOCUMENTO SIN VALOR FISCAL
        </div>

        <div class="boleta-info">
            <div><strong>Fecha:</strong> <span id="boletaFecha"></span></div>
            <div id="boletaClienteDiv" style="display: none;"><strong>Cliente:</strong> <span id="boletaCliente"></span></div>
            <div id="boletaIdDiv" style="display: none;"><strong>ID Interno:</strong> <span id="boletaId"></span></div>
        </div>

        <div class="boleta-items">
            <div class="boleta-item-header">
                <div>Cant.</div>
                <div>Producto</div>
                <div>P. Unit.</div>
                <div>Subtotal</div>
            </div>
            <div id="boletaItemsContainer"></div>
        </div>

        <div class="boleta-total">
            TOTAL: $ <span id="boletaTotal"></span>
        </div>

        <div class="boleta-pago">
            <strong>Forma de pago:</strong> <span id="boletaPago"></span>
        </div>

        <div class="boleta-footer">
            <div class="boleta-gracias">Gracias por tu compra.</div>
            <div class="boleta-redes">
                Instagram: @fisicasimpleuy<br>
                Facebook: F√≠sica Simple<br>
                www.fisicasimple.com
            </div>
        </div>

        <div class="boleta-disclaimer">
            Este documento es SOLO informativo. No es factura, ticket ni recibo fiscal ante DGI y no discrimina IVA. Cuando corresponda, la operaci√≥n ser√° documentada por el comprobante fiscal v√°lido.
        </div>
    </div>

    <script>
        let itemCount = 0;
        let imagenGenerada = null;

        // Establecer fecha actual
        document.getElementById('fecha').valueAsDate = new Date();

        // Mostrar campo de otros si se selecciona
        document.getElementById('formaPago').addEventListener('change', function() {
            const otrosDiv = document.getElementById('otrosPagoDiv');
            if (this.value === 'Otros') {
                otrosDiv.style.display = 'block';
            } else {
                otrosDiv.style.display = 'none';
            }
        });

        function agregarItem() {
            itemCount++;
            const container = document.getElementById('itemsContainer');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-row';
            itemDiv.id = `item-${itemCount}`;
            itemDiv.innerHTML = `
                <label>Cantidad:</label>
                <input type="number" min="1" value="1" class="item-cantidad" onchange="calcularTotal()">
                
                <label>Nombre del Producto:</label>
                <input type="text" placeholder="Ej: Cuaderno, Lapicera..." class="item-nombre">
                
                <label>Precio Unitario ($):</label>
                <input type="number" min="0" step="0.01" placeholder="0.00" class="item-precio" onchange="calcularTotal()">
                
                <label>Subtotal ($):</label>
                <input type="text" class="item-subtotal" readonly value="0.00">
                
                <button class="btn btn-remove" onclick="eliminarItem(${itemCount})">‚úï ELIMINAR PRODUCTO</button>
            `;
            container.appendChild(itemDiv);
        }

        function eliminarItem(id) {
            const item = document.getElementById(`item-${id}`);
            if (item) {
                item.remove();
                calcularTotal();
            }
        }

        function calcularTotal() {
            const items = document.querySelectorAll('.item-row');
            let total = 0;

            items.forEach(item => {
                const cantidad = parseFloat(item.querySelector('.item-cantidad').value) || 0;
                const precio = parseFloat(item.querySelector('.item-precio').value) || 0;
                const subtotal = cantidad * precio;
                item.querySelector('.item-subtotal').value = subtotal.toFixed(2);
                total += subtotal;
            });

            document.getElementById('totalDisplay').textContent = total.toFixed(2);
        }

        async function generarBoleta() {
            // Validar que haya al menos un producto
            const items = document.querySelectorAll('.item-row');
            if (items.length === 0) {
                alert('Debes agregar al menos un producto');
                return;
            }

            // Validar que todos los productos tengan nombre y precio
            let valido = true;
            items.forEach(item => {
                const nombre = item.querySelector('.item-nombre').value.trim();
                const precio = item.querySelector('.item-precio').value;
                if (!nombre || !precio) {
                    valido = false;
                }
            });

            if (!valido) {
                alert('Todos los productos deben tener nombre y precio');
                return;
            }

            // Llenar datos de la boleta
            const fecha = document.getElementById('fecha').value;
            const fechaFormateada = fecha ? new Date(fecha + 'T00:00:00').toLocaleDateString('es-UY') : '___/___/______';
            document.getElementById('boletaFecha').textContent = fechaFormateada;

            const cliente = document.getElementById('cliente').value.trim();
            const clienteDiv = document.getElementById('boletaClienteDiv');
            if (cliente) {
                document.getElementById('boletaCliente').textContent = cliente;
                clienteDiv.style.display = 'block';
            } else {
                clienteDiv.style.display = 'none';
            }

            const idInterno = document.getElementById('idInterno').value.trim();
            const idDiv = document.getElementById('boletaIdDiv');
            if (idInterno) {
                document.getElementById('boletaId').textContent = idInterno;
                idDiv.style.display = 'block';
            } else {
                idDiv.style.display = 'none';
            }

            // Llenar items
            const boletaItemsContainer = document.getElementById('boletaItemsContainer');
            boletaItemsContainer.innerHTML = '';
            
            items.forEach(item => {
                const cantidad = item.querySelector('.item-cantidad').value;
                const nombre = item.querySelector('.item-nombre').value;
                const precio = parseFloat(item.querySelector('.item-precio').value).toFixed(2);
                const subtotal = item.querySelector('.item-subtotal').value;

                const itemDiv = document.createElement('div');
                itemDiv.className = 'boleta-item';
                itemDiv.innerHTML = `
                    <div>${cantidad}</div>
                    <div>${nombre}</div>
                    <div>$${precio}</div>
                    <div>$${subtotal}</div>
                `;
                boletaItemsContainer.appendChild(itemDiv);
            });

            // Total
            document.getElementById('boletaTotal').textContent = document.getElementById('totalDisplay').textContent;

            // Forma de pago
            let formaPago = document.getElementById('formaPago').value;
            if (formaPago === 'Otros') {
                const otros = document.getElementById('otrosPago').value.trim();
                formaPago = otros || 'Otros';
            }
            document.getElementById('boletaPago').textContent = formaPago;

            // Mostrar la boleta temporalmente para capturarla
            const boleta = document.getElementById('boleta');
            boleta.classList.remove('hidden');
            boleta.style.position = 'fixed';
            boleta.style.left = '0';
            boleta.style.top = '0';
            boleta.style.zIndex = '-1';

            // Esperar un momento para que las fuentes se carguen
            await new Promise(resolve => setTimeout(resolve, 500));

            // Generar la imagen con html2canvas
            try {
                const canvas = await html2canvas(boleta, {
                    backgroundColor: '#ffffff',
                    scale: 3, // Mayor calidad
                    logging: false,
                    useCORS: true
                });

                // Ocultar la boleta nuevamente
                boleta.classList.add('hidden');
                boleta.style.position = '';
                boleta.style.left = '';
                boleta.style.top = '';
                boleta.style.zIndex = '';

                // Guardar la imagen
                imagenGenerada = canvas;

                // Mostrar la vista previa
                mostrarVistaPrevia(canvas);

            } catch (error) {
                console.error('Error al generar la imagen:', error);
                alert('Hubo un error al generar la imagen. Por favor intenta nuevamente.');
                boleta.classList.add('hidden');
            }
        }

        function mostrarVistaPrevia(canvas) {
            // Ocultar formulario
            document.getElementById('formContainer').style.display = 'none';
            
            // Mostrar vista previa
            const previewSection = document.getElementById('previewSection');
            previewSection.classList.add('visible');

            // Agregar canvas al contenedor
            const canvasContainer = document.getElementById('canvasContainer');
            canvasContainer.innerHTML = '';
            canvasContainer.appendChild(canvas);

            // Scroll al inicio
            window.scrollTo(0, 0);
        }

        function volverAlFormulario() {
            // Ocultar vista previa
            document.getElementById('previewSection').classList.remove('visible');
            
            // Mostrar formulario
            document.getElementById('formContainer').style.display = 'block';

            // Scroll al inicio
            window.scrollTo(0, 0);
        }

        function descargarImagen() {
            if (!imagenGenerada) {
                alert('No hay imagen para descargar');
                return;
            }

            // Convertir canvas a blob
            imagenGenerada.toBlob(function(blob) {
                // Crear un enlace de descarga
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                // Generar nombre de archivo con fecha
                const fecha = new Date();
                const nombreArchivo = `boleta-fisica-simple-${fecha.getFullYear()}${String(fecha.getMonth()+1).padStart(2,'0')}${String(fecha.getDate()).padStart(2,'0')}-${String(fecha.getHours()).padStart(2,'0')}${String(fecha.getMinutes()).padStart(2,'0')}.png`;
                
                link.download = nombreArchivo;
                link.href = url;
                link.click();
                
                // Liberar el objeto URL
                URL.revokeObjectURL(url);
            });
        }

        // Agregar un item inicial
        agregarItem();
    </script>
</body>
</html>
